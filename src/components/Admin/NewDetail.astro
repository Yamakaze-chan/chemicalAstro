<section class="bg-white text-[var(--color-3)] py-12">
  <div id="new-detail" class="max-w-7xl mx-auto px-4 flex flex-col lg:flex-row gap-12 mt-[5%]">

  </div>
</section>

<style>
/* Container ch√≠nh */
.content-body {
  overflow-x: hidden;
  word-break: break-word;
  line-height: 1.6;
}

/* ·∫¢nh (m·ªçi ngu·ªìn, k·ªÉ c·∫£ inline style) */
.content-body img {
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important;
  display: block !important;
  margin: 1rem auto !important;
  margin-left: auto !important;
  margin-right: auto !important;
  object-fit: contain;
}

/* Figure: ·∫£nh v√† caption */
.content-body figure {
  width: 100% !important;
  max-width: 100% !important;
  margin: 1rem auto !important;
  display: block !important;
  text-align: center !important;
}

.content-body figure figcaption,
.content-body figcaption {
  width: 100% !important;
  max-width: 100% !important;
  font-size: 0.9rem !important;
  font-style: italic !important;
  color: #666 !important;
  text-align: center !important;
  margin-top: 0.5rem !important;
  padding: 0 1rem !important;
  line-height: 1.5 !important;
}

/* TABLE trong figure ho·∫∑c n·ªôi dung d√°n */
.content-body table {
  width: 100% !important;
  max-width: 100% !important;
  border-collapse: collapse !important;
  overflow-x: auto !important;
  display: block !important;
  margin: 1rem 0 !important;
}

/* CELL */
.content-body td,
.content-body th {
  width: auto !important;
  max-width: 100% !important;
  padding: 0.5rem !important;
  border: 1px solid #ddd !important;
  vertical-align: top !important;
  text-align: left !important;
  word-break: break-word !important;
}

.content-body th {
  background-color: #f3f4f6 !important;
  font-weight: 600 !important;
}

/* Responsive iframe/video */
.content-body iframe,
.content-body video {
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important;
  display: block !important;
  margin: 1rem auto !important;
}

/* Responsive n·∫øu n·ªôi dung ch·ª©a style width c·ª©ng */
.content-body [style*="width"],
.content-body [style*="max-width"] {
  width: 100% !important;
  max-width: 100% !important;
}

/* ƒê·∫£m b·∫£o caption hi·ªÉn th·ªã ƒë·∫πp */
.content-body em {
  font-style: italic;
  color: #666;
}
.content-body p {
  text-align: left !important;
}
</style>


<script>
  const newDetail = document.getElementById('new-detail');
  const urlParams = new URLSearchParams(window.location.search);
  const id = parseInt(urlParams.get("id"));

  function cleanHTML(html) {
  const wrapper = document.createElement("div");
  wrapper.innerHTML = html;

  // Danh s√°ch c√°c style cho ph√©p
  const allowedStyles = [
    "text-align",
    "float",
    "margin-left",
    "margin-right",
    "display",
    "font-size",
    "font-style",
    "font-weight",
    "color",
    "background-color",
    "border",
    "box-shadow",
    "padding",
    "margin",
    "border-radius"
  ];

  wrapper.querySelectorAll("[style]").forEach(el => {
    const style = el.getAttribute("style");
    if (!style) return;

    const safeStyles = style
      .split(";")
      .map(s => s.trim())
      .filter(s => allowedStyles.some(allow => s.startsWith(allow)))
      .join("; ");

    if (safeStyles) {
      el.setAttribute("style", safeStyles);
    } else {
      el.removeAttribute("style");
    }
  });

  // G·ª° b·ªè <p> b·ªçc quanh ·∫£nh ƒë∆°n ƒë·ªôc
  wrapper.querySelectorAll("p").forEach(p => {
    const onlyImg = p.querySelector("img");
    if (onlyImg && p.childNodes.length === 1) {
      p.replaceWith(onlyImg);
    }
  });

  return wrapper.innerHTML;
}




  async function fetchNewsDetail() {
    if (!id || isNaN(id)) {
      newDetail.innerHTML = `<p class="text-red-500 text-xl font-semibold">ID kh√¥ng h·ª£p l·ªá.</p>`;
      return;
    }

    try {
      const res = await fetch(`/api/news?id=${id}`);
      if (!res.ok) {
        newDetail.innerHTML = `<p class="text-red-500 text-xl font-semibold">Kh√¥ng t√¨m th·∫•y tin t·ª©c.</p>`;
        return;
      }
      const newItem = await res.json();
      const cleanedContent = cleanHTML(newItem.content);

      newDetail.innerHTML = `
        <div class="w-full space-y-8">
          <h1 class="text-4xl font-extrabold text-center text-[var(--color-1)]">
            ${newItem.title}
          </h1>

          <div class="p-6 rounded-lg text-gray-700 leading-relaxed text-center">
            <div class="text-lg inline-block text-left max-w-3xl w-full content-body">
              ${cleanedContent}
            </div>
          </div>

          <div class="flex flex-wrap justify-end gap-4 pt-8 border-t mt-12">
            <a href="/admin/editnew?id=${newItem.id}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg font-semibold shadow transition">
              ‚úèÔ∏è S·ª≠a
            </a>
            <button id="delete-btn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-semibold shadow transition">
              üóëÔ∏è X√≥a
            </button>
            <a href="/admin/news" class="bg-gray-700 hover:bg-gray-800 text-white px-6 py-2 rounded-lg font-semibold shadow transition">
              ‚Üê Quay v·ªÅ danh s√°ch
            </a>
          </div>
        </div>
      `;

      document.getElementById("delete-btn")?.addEventListener("click", async () => {
        if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a tin t·ª©c n√†y?")) return;
        try {
          const delRes = await fetch("/api/delete-news", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id }),
          });

          if (!delRes.ok) {
            const text = await delRes.text();
            alert("L·ªói server: " + text);
            return;
          }

          alert("ƒê√£ x√≥a tin t·ª©c.");
          window.location.href = "/admin/news";
        } catch (err) {
          alert("L·ªói k·∫øt n·ªëi m√°y ch·ªß.");
          console.error(err);
        }
      });

    } catch (err) {
      newDetail.innerHTML = `<p class="text-red-500 text-xl font-semibold">L·ªói khi l·∫•y d·ªØ li·ªáu tin t·ª©c.</p>`;
      console.error("Fetch news detail error:", err);
    }
  }

  fetchNewsDetail();
</script>
